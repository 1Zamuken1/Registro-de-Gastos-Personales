<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="../assets/icons/gastu_logo.svg" type="image/x-icon">
    <title>Ingresos</title>
    <link rel="stylesheet" href="../assets/css/nav-bar.css" />
    <link rel="stylesheet" href="../assets/css/ingresos.css" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.css" rel="stylesheet">
  </head>
  <body>
    <div class="layout">
      <!-- Barra lateral de navegación -->
      <div id="nav-bar"></div>
      <div class="page-content">
        <div class="contenedor">
          <h1>Mis Ingresos</h1>
          <div id="filtros-grafico" style="text-align:center; margin-bottom: 24px;">
            <select id="select-rango-grafico" style="padding:8px 16px; border-radius:8px; border:1px solid #e9ecef;">
              <option value="dia">Día</option>
              <option value="mes" selected>Mes</option>
              <option value="trimestre">Trimestre</option>
              <option value="semestre">Semestre</option>
              <option value="anio">Año</option>
            </select>
          </div>

          <div class="grafico-titulos">
  <div class="grafico-titulo" id="grafico-titulo"></div>
  <div class="grafico-subtitulo" id="grafico-subtitulo"></div>
</div>
          <div id="graficos-ingresos" style="max-width:1500px; width:100%; margin:0 auto;">
  <div id="grafico-totales" style="display:block;">
    <div id="chart-ingresos" style="max-width:900px; margin:0 auto 32px auto;"></div>
  </div>
  <div id="grafico-programados" style="display:none;">
    <div id="chart-programados" style="max-width:1400px; margin:0 auto 32px auto;"></div>
  </div>
  <div id="grafico-variables" style="display:none;">
    <div id="chart-variables" style="max-width:1400px; margin:0 auto 32px auto;"></div>
  </div>
</div>

          <!-- Filtros debajo del gráfico -->
          <div class="filtros-ingresos-barra" style="display: flex; justify-content: center; align-items: center; margin-bottom: 32px; max-width: 900px; margin: 0 auto;">
            <div class="filtros-indicativo" style="font-size: 1.15rem; color: #4E8EC6; font-weight: 600; margin-right: 18px;">
              Ver:
            </div>
            <div class="filtros-ingresos" style="gap: 12px; margin-bottom: 0;">
              <button type="button" class="btn-filtro-ingresos activo" id="btn-todos-ingresos">
                Ingresos totales
              </button>
              <button type="button" class="btn-filtro-ingresos" id="btn-programados-ingresos">
                Ingresos programados
              </button>
              <button type="button" class="btn-filtro-ingresos" id="btn-variables-ingresos">
                Ingresos variables
              </button>
            </div>
          </div>
          <br>
          <div class="tarjetas-ingresos">
            <!-- Tarjeta para añadir ingreso SIEMPRE PRIMERA -->
            <div
              class="tarjeta-ingreso tarjeta-agregar"
              id="tarjeta-agregar-ingreso"
              style="display: none;"
            >
              <div class="agregar-contenido">
                <span class="agregar-icono">
                  <img
                    src="../assets/icons/plus.svg"
                    alt="Agregar"
                    width="32"
                    height="32"
                  />
                </span>
                <span class="agregar-texto">Añadir ingreso</span>
              </div>
            </div>
            <!-- Las demás tarjetas se agregan por JS -->
          </div>
        </div>

        <!-- MODAL DETALLE DE INGRESO -->
        <div id="modal-ingreso" class="modal-ingreso-oculto">
          <div class="modal-contenido">
            <span class="modal-cerrar" id="cerrar-modal">
              <img
                src="../assets/icons/close.svg"
                alt="Cerrar"
                width="28"
                height="28"
              />
            </span>
            <h2 id="modal-titulo">Detalle del Ingreso</h2>
            <div class="modal-campos">
              <div>
                <strong>Concepto:</strong> <span id="modal-concepto"></span>
              </div>
              <div><strong>Monto:</strong> <span id="modal-monto"></span></div>
              <div>
                <strong>Descripción:</strong>
                <span id="modal-descripcion"></span>
              </div>
              <div>
                <strong>Fecha creación:</strong> <span id="modal-fecha"></span>
              </div>
              <div><strong>Fijo:</strong> <span id="modal-fijo"></span></div>
              <div id="modal-proxima-recurrencia-row" style="display:none;">
                <strong>Próxima recurrencia:</strong> <span id="modal-proxima-recurrencia"></span>
              </div>
            </div>
          </div>
        </div>

        <!-- MODAL EDITAR/AGREGAR INGRESO -->
        <div id="modal-editar-ingreso" class="modal-ingreso-oculto">
          <div class="modal-contenido">
            <div class="modal-barra-superior">
              <h2 id="modal-titulo-editar">Editar Ingreso</h2>
              <span class="modal-cerrar" id="cerrar-modal-editar">
                <img
                  src="../assets/icons/close.svg"
                  alt="Cerrar"
                  width="28"
                  height="28"
                />
              </span>
            </div>
            <form id="form-editar-ingreso" autocomplete="off">
              <div class="modal-campos">
                <div>
                  <label><strong>Concepto:</strong></label>
                  <input type="text" id="editar-concepto" readonly placeholder="Selecciona un concepto" required />
                    <!-- Las opciones se llenan por JS -->
                  </select>
                </div>
                <div>
                  <label><strong>Descripción:</strong></label>
                  <input type="text" id="editar-descripcion" />
                </div>
                <div>
                  <label><strong>Tipo de ingreso:</strong></label>
                  <select id="editar-tipo" required>
                    <option value="variable">Variable</option>
                    <option value="fijo">Programado</option>
                  </select>
                </div>
                <div id="campos-variable">
                  <div>
                    <label><strong>Monto:</strong></label>
                    <input type="number" id="editar-monto-variable" min="1" />
                  </div>
                  <div>
                    <label><strong>Fecha recibido:</strong></label>
                    <input type="date" id="editar-fecha-variable" />
                  </div>
                </div>
                <div id="campos-fijo" style="display: none">
                  <div>
                    <label><strong>Monto:</strong></label>
                    <input type="number" id="editar-monto-fijo" min="1" />
                  </div>
                  <div>
                    <label><strong>Frecuencia:</strong></label>
                    <select id="editar-frecuencia">
                      <option value="mensual">Mensual</option>
                      <option value="quincenal">Quincenal</option>
                      <option value="semanal">Semanal</option>
                      <option value="anual">Anual</option>
                    </select>
                  </div>
                  <div>
                    <label><strong>Fecha inicio:</strong></label>
                    <input type="date" id="editar-fecha-inicio" />
                    <button type="button" id="btn-hoy-editar-programado" class="btn-eliminar-cancelar" style="padding: 8px 16px; margin-top: 0;">Hoy</button>
                  </div>
                </div>
              </div>
              <button type="submit" class="btn-guardar">Guardar</button>
            </form>
          </div>
        </div>

        <!-- MODAL ELIMINAR INGRESO -->
        <div id="modal-eliminar-ingreso" class="modal-ingreso-oculto">
          <div class="modal-contenido modal-eliminar">
            <span class="modal-cerrar" id="cerrar-modal-eliminar">
              <img
                src="../assets/icons/close.svg"
                alt="Cerrar"
                width="28"
                height="28"
              />
            </span>
            <div class="modal-eliminar-icono">
              <img
                src="../assets/icons/delete.svg"
                alt="Eliminar"
                width="48"
                height="48"
              />
            </div>
            <h2>¿Eliminar ingreso?</h2>
            <p>
              ¿Estás seguro de que deseas eliminar el ingreso
              <strong id="nombre-ingreso-eliminar"></strong>? Esta acción no se
              puede deshacer.
            </p>
            <div class="modal-eliminar-botones">
              <button
                id="btn-confirmar-eliminar"
                class="btn-eliminar-confirmar"
              >
                Sí, eliminar
              </button>
              <button id="btn-cancelar-eliminar" class="btn-eliminar-cancelar">
                No, cancelar
              </button>
            </div>
          </div>
        </div>

        <!-- Modal de confirmación para ingreso programado -->
        <div id="modal-confirmar-programado" class="modal-ingreso-oculto">
          <div class="modal-contenido">
            <span
              class="modal-cerrar"
              id="cerrar-modal-confirmar-programado"
              style="cursor: pointer; float: right; font-size: 1.5rem"
              >&times;</span
            >
            <h2>Confirmar ingreso programado</h2>
            <p>
              ¿Estás seguro de que deseas registrar este ingreso como
              <strong>programado</strong>? Se generarán ingresos automáticamente
              según la frecuencia y fecha de inicio.
            </p>
            <div style="text-align: right; margin-top: 24px">
              <button
                id="btn-cancelar-programado"
                class="btn-eliminar-cancelar"
              >
                Cancelar
              </button>
              <button
                id="btn-confirmar-programado"
                class="btn-guardar"
                style="margin-left: 12px"
              >
                Confirmar
              </button>
            </div>
          </div>
        </div>

        <!-- Modal para seleccionar concepto -->
        <div id="modal-conceptos" class="modal-ingreso-oculto">
          <div class="modal-contenido" style="max-width: 900px; position: relative;">
            <span class="modal-cerrar" id="cerrar-modal-conceptos" style="top: 16px; right: 20px;">&times;</span>
            <h2>Selecciona un concepto de ingreso</h2>
            <div id="lista-conceptos"></div>
            <button class="btn-eliminar-cancelar" style="margin-top: 24px" onclick="document.getElementById('modal-conceptos').classList.add('modal-ingreso-oculto');document.getElementById('modal-conceptos').style.display='';">
              Cancelar
            </button>
          </div>
        </div>

        <!-- Modal para formulario de ingresos programados -->
        <div id="modal-formulario-programado" class="modal-ingreso-oculto">
          <div class="modal-contenido">
            <span class="modal-cerrar" id="cerrar-modal-formulario-programado">&times;</span>
            <h2>Agregar ingreso programado</h2>
            <form id="form-programado" autocomplete="off">
              <div class="modal-campos">
                <div>
                  <label for="concepto-programado"><strong>Concepto:</strong></label>
                  <input type="text" id="concepto-programado" readonly placeholder="Selecciona un concepto" required />
                </div>
                <div>
                  <label for="descripcion-programado"><strong>Descripción:</strong></label>
                  <input type="text" id="descripcion-programado" />
                </div>
                <div>
                  <label for="monto-programado"><strong>Monto:</strong></label>
                  <input type="number" id="monto-programado" min="1" required />
                </div>
                <div>
                  <label for="frecuencia-programado"><strong>Frecuencia:</strong></label>
                  <select id="frecuencia-programado" required>
                    <option value="mensual">Mensual</option>
                    <option value="quincenal">Quincenal</option>
                    <option value="semanal">Semanal</option>
                    <option value="anual">Anual</option>
                  </select>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <label for="fecha-inicio-programado" style="flex: 0 0 120px;"><strong>Fecha inicio:</strong></label>
                  <input type="date" id="fecha-inicio-programado" required style="flex: 1;" />
                  <button type="button" id="btn-hoy-programado" class="btn-eliminar-cancelar" style="padding: 8px 16px; margin-top: 0;">Hoy</button>
                </div>
              </div>
              <div style="display: flex; gap: 16px; margin-top: 24px;">
                <button type="submit" class="btn-guardar">Guardar</button>
                <button type="button" class="btn-eliminar-cancelar" id="cancelar-programado">Cancelar</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Modal para formulario de ingresos variables -->
        <div id="modal-formulario-variable" class="modal-ingreso-oculto">
          <div class="modal-contenido">
            <span class="modal-cerrar" id="cerrar-modal-formulario-variable">&times;</span>
            <h2>Agregar ingreso variable</h2>
            <form id="form-variable" autocomplete="off">
              <div class="modal-campos">
                <div>
                  <label for="concepto-variable"><strong>Concepto:</strong></label>
                  <input type="text" id="concepto-variable" placeholder="Escribe el concepto" required />
                </div>
                <div>
                  <label for="descripcion-variable"><strong>Descripción:</strong></label>
                  <input type="text" id="descripcion-variable" />
                </div>
                <div>
                  <label for="monto-variable"><strong>Monto:</strong></label>
                  <input type="number" id="monto-variable" min="1" required />
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <label for="fecha-variable" style="flex: 0 0 120px;"><strong>Fecha recibido:</strong></label>
                  <input type="date" id="fecha-variable" required style="flex: 1;" />
                  <button type="button" id="btn-hoy-variable" class="btn-eliminar-cancelar" style="padding: 8px 16px; margin-top: 0;">Hoy</button>
                </div>
              </div>
              <div style="display: flex; gap: 16px; margin-top: 24px;">
                <button type="submit" class="btn-guardar">Guardar</button>
                <button type="button" class="btn-eliminar-cancelar" id="cancelar-variable">Cancelar</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- Scripts -->
    <script src="../assets/js/nav-bar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="../assets/js/ingresos.js"></script>
  </body>
</html>
